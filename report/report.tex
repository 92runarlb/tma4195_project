\documentclass[12pt]{article}
\usepackage{style}


\author{Aga, Kristian, Berge, Runar L., Klemetsdal Ã˜ystein,\\
	MyrvollNilsen, Eirik, Selle, Maria\\\\
	Industrial Mathematics\\
	NTNU \\\\
}
\title{Cool Title Goes Here \\     
	TMA4195}
\begin{document}
\maketitle
\clearpage

%
%    INTRODUCTION
%
\section{Introduction}

Set problem in context.

In this modelling project, we will address three major phases in the development of a tsunami:
\begin{enumerate}[label = \emph{(\roman*)}]
    \item    The creation of a tsunami wave, when the kinetic energy of a falling rock is transferred to the
             water,
    \item    The propagation of the wave in the parts of the fjord where the bottom as approximately constant
             elevation,
    \item    The run-up of the wave when it reaches the end of the fjord and the height of the wave starts
             increasing at the same time that its speed decreases.
\end{enumerate}

In the case of a tsunami event close to a populated area, two questions are of particular interest:
\begin{enumerate}[label = \emph{(\roman*)}]
    \item    How long does it take for the wave to reach the populated area?
    \item    What is the height of the wave when it reaches the shore?
\end{enumerate}

Add extra..

\section{Theory}

\subsection{Governing Equations}

\subsubsection*{Conservation of Mass}

We consider a fluid occupying a domain $\Omega \subset \mathbb{R}^3$. Let $\rho = \rho(\bm{x}, t)$, and
$\bm{v} = \bm{v}(\bm{x},t)$ denote the density and velocity of the fluid, respectively, at a position
$\bm{x} = (x,y,z) \in \Omega$ at a time $t > 0$. We look at a control volume $\mathcal{C}$, with surface $\partial \mathcal{C}$.
The rate of change of total mass in $\mathcal{C}$ is then
\begin{align}
    \frac{\d}{\d t}\int_\mathcal{C} \rho(\bm{x},t) \, \d V.
\end{align}
Consider now a small part of the surface $\partial \mathcal{C}$, with area $\d S$. Let $\bm{n}$ denote the outward normal
of $\partial \mathcal{C}$. The mass flux through this surface element is then $-\rho \bm{v} \cdot \bm{n} \, \d S$, so the
total mass flux through the boundary of $\mathcal{C}$ is then
\begin{align}
    -\int_{\partial \mathcal{C}}\rho \bm{v} \cdot \bm{n} \, \d S.
\end{align}
Assuming that there are no sources or sinks within $\mathcal{C}$, conservation of mass requires that
\begin{align}
    \frac{\d}{\d t}\int_\mathcal{C} \rho(\bm{x},t) \, \d V
                            = -\int_{\partial \mathcal{C}}\rho \bm{v} \cdot \bm{n} \, \d S.
\end{align}

Using the divergence theorem we can transform the second integral into
a volume integral. Further we assume $\rho$ to be sufficiently smooth
so we can move the derivative inside the integral sign (Note that
$\mathcal{C}$ does not depend on time, so that $\frac{\d \rho(\bm x,t)}{\d
  t}= \rho_t(\bm x, t)$);
\begin{align}
    \int_\mathcal{C} \big(\rho_t(\bm{x},t) + \nabla \cdot (\rho \bm{v}) \big) \, \d V = 0.
\end{align}
Now, this is true for any control volume $\mathcal{C} \subset \Omega$. This gives that the integrand is zero. Indeed;
if we assume that the integrand is zero at some point in $\Omega$, continuity of $\rho$ and $\bm{v}$
gives that the integral would be positive, which is a contradiction. Hence, we have
\begin{align}
    \label{eq:massConservation}
    \rho_t(\bm{x},t) + \nabla \cdot (\rho \bm{v}) = 0.
\end{align}

%
%    Conservation of Momentum
%
\subsubsection*{Conservation of Momentum}

We have
\begin{align}
	\begin{aligned}
	    \frac{\d}{\d t} \int_{\Omega(t)} \rho \bm{v} \, \d V 
	        & = \int_{\Omega(t)} \big(\frac{\partial}{\partial t}(\rho \bm{v})
	                + \bm{v} \nabla \cdot (\rho \bm{v}) \big) \, \d V
	                - \int_{\partial \Omega} \bm{v} \times (\rho \bm{v}) \, \d S \\
	        & = \int_{\Omega(t)} \big(\frac{\partial}{\partial t}(\rho \bm{v})
	                + \bm{v} \nabla \cdot (\rho \bm{v}) \big) \, \d V                
	\end{aligned}
\end{align}

Div on each component
\begin{align}
    \int_{\partial \Omega} p \, \bm{n} \, d S = \int_{\Omega} \nabla p \, d V,
\end{align}

\begin{align}
    \int_{\Omega(t)} \bigg(\frac{\partial}{\partial t}(\rho \bm{v})
	                + \bm{v} \nabla \cdot (\rho \bm{v}) + \nabla p - \rho \bm{g} \bigg) \, \d V = 0
\end{align}

\begin{align}
    \lim_{\Omega(t) \rightarrow 0} \frac{1}{|\Omega(t)|}\int_{\Omega(t)} \bigg(\frac{\partial}{\partial t}(\rho \bm{v})
	                + \bm{v} \nabla \cdot (\rho \bm{v}) + \nabla p - \rho \bm{g} \bigg) \, \d V \\
	                = \frac{\partial}{\partial t}(\rho \bm{v})
	                + \bm{v} \nabla \cdot (\rho \bm{v}) + \nabla p - \rho \bm{g} = 0
\end{align}
Hence, conservation of momentum yields
\begin{align}
    \label{eq:momentumConservation}
    \rho \bm{v}_t + \rho(\bm{v} \cdot \nabla) \bm{v} + \nabla p - \rho \bm{g} = 0
\end{align}

\section{Boundary Conditions}

\begin{align}
	\begin{cases}
	    \bm{v}\cdot \bm{n} = 0,    &  \quad  \forall (x,y) \in \mathbb{R}^2, z = -h(x,y) \\
	    \eta(x,y,0) = f(x,y), &  \quad  \forall (x,y) \in \mathbb{R}^2
	\end{cases}.
\end{align}

\subsubsection*{Two vector calculus results}

Let $\phi$ be a scalar function, we have
\begin{align}
    \nabla \times (\nabla \phi) = \nabla \times (\phi_x, \phi_y, \phi_z) =
        \big(\phi_{zy} - \phi_{yz}, -(\phi_{zx} - \phi_{xz}), \phi_{xy} - \phi_{yx} \big).
\end{align}
From the properties of the mixed partial derivative, we have $\phi_{x_i x_j} = \phi_{x_j x_i}$. Hence,
\begin{align}
    \label{eq:curlScalar}
    \nabla \times (\nabla \phi) = 0 \quad \forall \text{ scalar functions } \phi.
\end{align}

We will also use the vector calculus identity
\begin{align}
    \label{eq:vecCalc}
    \frac{1}{2}\nabla |\bm{v}|^2 = (\bm{v}\cdot \nabla) \bm{v} + \bm{v} \times (\nabla \times \bm{v}).
\end{align}

\subsubsection{Set of equations...}

We now define our velocity to be the gradient of a scalar field $\phi$, that is, $\bm{v} = \nabla \phi$.

We now want to simplify our equations. First, we want $\bm{v}$ to e irrotational, that is,
$\nabla \times \bm{v} = 0$. Now, \ref{eq:curlScalar} implies that $\bm{v}$ is the gradient of a scalar field
$\phi$. Inserting $\bm{v} = \nabla \phi$, into \eqref{eq:vecCalc}, we obtain
\begin{align}
    (\nabla \phi \cdot \nabla) \nabla \phi = \frac{1}{2}\nabla |\nabla \phi|^2
\end{align}
Further, we can write $\bm{g} = (0,0,g)$, where $g = |\bm{g}|$ is the gravitational acceleration, so that
$\bm{g} = \nabla (gz)$. Hence, from \eqref{eq:momentumConservation}, we have
\begin{align}
    \nabla\bigg(\phi_t + \frac{1}{2}|\nabla \phi|^2 + \frac{p}{\rho} - g z \bigg) = 0
    \iff \phi_t + \frac{1}{2}|\nabla \phi|^2 + \frac{p}{\rho}  g z = C(t),
\end{align}
where $C(t)$ is a function of $t$ alone. Assuming a still water surface far from the origin, i.e.
\begin{align}
    \begin{cases}
	    \lim_{\bm{x} \rightarrow \pm(\infty,\infty, 0)}\bm{v} & = 0 \\
	    \lim_{\bm{x} \rightarrow \pm(\infty,\infty, 0)}\eta   & = 0
	\end{cases}, \quad \forall t > 0,
\end{align}
we get that $C(t) = \frac{p_{atm}}{\rho}$.

We also make the reasonable assumption that $\rho$ is a constant. \eqref{eq:massConservation} now reduces to
$\nabla \cdot \bm{v} = \Delta \phi = 0$, which gives that the fluid is incompressible. We now have
the equations
\begin{align}
    \begin{cases}
        \Delta \phi = 0,                                                 &  (x,y) \in \Omega(t), \, t > 0 \\
        \phi_t + \frac{1}{2}|\nabla \phi|^2 + \frac{p-p_{atm}}{\rho} - g z = 0,
                                                                         &  (x,y) \in \Omega(t), \, t > 0 \\
    \end{cases}.
\end{align}
The boundary conditions yields $\nabla \phi \cdot \bm{n}|_{z = -h(x,y)} = 0$

We 

\section{Numerical simulation of Navier Stokes}

\begin{align*}
    \frac{\eta_i^{n+1} - \eta_i^n}{k} + (\phi_x)_i^{n} \frac{\eta_{i+1}^{n+1}-\eta_{i-1}^{n}}{2h} - (\phi_z)_i^n = 0
\end{align*}

which yields the matrix system

\begin{align}
    \label{eq:etan+1}
    \bm{A} \bm{\eta}^{n+1} = \frac{1}{k}\bm{\eta}^n + \bm{\phi}_z^n,
\end{align}
where $\bm{A}$ is a tridiagonal matrix with the following diagonals:
\begin{align*}
    \text{Super diagonal: } &\frac{1}{2h} \Big((\phi_x)_2^{n}, (\phi_x)_3^{n} \dots, 2(\phi_M)^{n}\Big) \\
    \text{Main diagonal: }  &\frac{1}{k}  \Big(1, \dots, 1\Big)                                        \\
    \text{Sub diagonal: }  -&\frac{1}{2h} \Big(2(\phi_x)_1^{n}, (\phi_x)_2^{n}, (\phi_x)_3^{n}, \dots, (\phi_x)_{M-1}^n \Big).
\end{align*}
Further, $\bm{\eta}^{n} = \Big(\eta_1^n, \dots, \eta_M^n\Big)^\top$, and $\bm{\phi}_z^n = \Big((\phi_z)_1^n, \dots, (\phi_z)_M^n\Big)^\top$.

\begin{align*}
    \frac{\phi_i^{n+1}-\phi_i^n}{k} + \frac{1}{2}|\nabla \phi_i^n|^2 + g \eta_i^{n+1} = 0,
\end{align*}
which can be written in matrix form as
\begin{align}
    \label{eq:phin+1}
    \bm{\phi}^{n+1} = \bm{\phi}^n - k\bigg(\frac{1}{2}\bm{\xi}^n + g \bm{\eta}^{n+1}\bigg),
\end{align}
where $\bm{\xi}^n = \Big(|\nabla \phi_1^n|^2, \dots,  |\nabla \phi_M^n|^2\bigg)$

\begin{algorithm}
    \caption{Das Algo}
	\begin{algorithmic}[1]
	\State    Input: $\bm{\eta}^0$, $\bm{\phi}^0$, $h$, $x_{\min}$, $x_{\max}$.
	    \For    {$n \leftarrow 0,N^T$}
	        \State    $\Omega^n \leftarrow \{(x,z) \in \mathbb{R}^2 : x_{\min} \leq x \leq x_{\max}, -h(x) \leq z \leq \eta(x)\}$ 
			\State    Calculate $\phi^{n}$, $\bm{\phi}_x^n$ and $\bm{\phi}_z^n$ using mimetic finite differences
			\State    Calculate $\bm{\eta}^{n+1}$ from \eqref{eq:etan+1}
			\State    Calculate $\bm{\phi}^{n+1}$ from \eqref{eq:phin+1}
        \EndFor
	\end{algorithmic}
\end{algorithm}

The first step in algorithm ref requires some consideration. MFD gives us the fluxes on each half-face, $v_{f} \approx \int_{f} \nabla \phi \cdot n_{f} \, \d s$.
Moreover, we know that any vector $\bm{v} \in \mathbb{R}^2$ can be written as $(\bm{v}\cdot\bm{n}_1) \bm{n}_1 + (\bm{v}\cdot\bm{n}_2) \bm{n}_2$,
where $\bm{n}_1$ and $\bm{n}_2$ are two orthogonal vectors of unit length.
Hence, in order to approximate $\nabla \phi$ on a top half-face $f_t$, we choose the corresponding right and left half-faces $f_r$ and $f_l$ sharing the same cell.
Since we are not altering the grid in the $x$-direction, we can then approximate $\nabla \phi|_{f_t}$ as
\begin{align*}
    \nabla \phi|_{f_t} \approx |f_t|^{-1} v_{f_t} \bm{n}_{f_t} + \frac{1}{2}(|f_l|^{-1}v_{f_l}-|f_r|^{-1}v_{f_r})\bm{n}_{f_r}.
\end{align*}
We then choose $\nabla \phi|_{f_t}$ to be our approximation of $\nabla \phi$ at the centroid of $f_t$.

\end{document}
